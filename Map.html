<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ Minecraft —Å–µ—Ä–≤–µ—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #1e1e1e;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
            color: white;
        }
        #dynmap-frame {
            width: 100%;
            height: 100vh;
            border: none;
            background: #1e1e1e;
        }
        .error-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d2d;
            color: white;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #ff4444;
            text-align: center;
            max-width: 400px;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }
        button:hover {
            background: #3367d6;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</h2>
        <p>–ò–¥—ë—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
        <div id="progress"></div>
    </div>

    <iframe 
        id="dynmap-frame"
        onload="hideLoading()"
        onerror="showError()"
        allow="fullscreen"
        sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox">
    </iframe>

    <div id="error-message" class="error-message">
        <h3>‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</p>
        <button onclick="reloadMap()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É</button>
        <button onclick="openDirect()">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É –Ω–∞–ø—Ä—è–º—É—é</button>
        <p style="margin-top: 15px; font-size: 12px; color: #ccc;">
            –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É<br>
            –∏–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        </p>
    </div>

    <script>
        let retryCount = 0;
        const maxRetries = 3;

        function loadMap() {
            const frame = document.getElementById('dynmap-frame');
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            frame.src = 'http://r14.joinserver.xyz:25994/';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            document.getElementById('progress').innerHTML = 
                `–ü–æ–ø—ã—Ç–∫–∞ ${retryCount + 1}/${maxRetries}`;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            console.log('–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
        }

        function showError() {
            retryCount++;
            
            if (retryCount < maxRetries) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                document.getElementById('progress').innerHTML = 
                    `–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞... (${retryCount + 1}/${maxRetries})`;
                setTimeout(loadMap, 2000);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
            }
        }

        function reloadMap() {
            retryCount = 0;
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            loadMap();
        }

        function openDirect() {
            window.open('http://r14.joinserver.xyz:25994/', '_blank');
        }

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        setTimeout(loadMap, 1000);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
        setTimeout(function() {
            if (document.getElementById('loading').style.display !== 'none') {
                showError();
            }
        }, 15000);

        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        console.log('DynMap Proxy –∑–∞–ø—É—â–µ–Ω');
        console.log('–¶–µ–ª–µ–≤–æ–π URL: http://r14.joinserver.xyz:25994/');
    </script>
</body>
</html>
